---
title: "FBI Database Compilation"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setup

```{r load-packages, message = FALSE}
library(tidyverse)
library(knitr)
library(rvest)
library(lubridate)
library(infer)
library(readxl)
set.seed(460)
```

```{r, message = FALSE}
crime_11 <- read_csv("fbi/2011_crime.csv")
crime_12 <- read_csv("fbi/2012_crime.csv")
crime_13 <- read_csv("fbi/2013_crime.csv")
crime_14 <- read_csv("fbi/2014_crime.csv")
crime_15 <- read_csv("fbi/2015_crime.csv")
crime_16 <- read_csv("fbi/2016_crime.csv")
crime_17 <- read_csv("fbi/2017_crime.csv")
crime_18 <- read_csv("fbi/2018_crime.csv")
crime_19 <- read_csv("fbi/2019_crime.csv")

```

## Basic Wrangling

```{r slice-footnotes}
crime_11 <- crime_11 %>% 
  slice(1:2261)
crime_12 <- crime_12 %>% 
  slice(1:2311)
crime_13 <- crime_13 %>% 
  slice(1:2385)
crime_14 <- crime_14 %>% 
  slice(1:2237)
crime_15 <- crime_15 %>% 
  slice(1:2227)
crime_16 <- crime_16 %>% 
  slice(1:2271)
crime_17 <- crime_17 %>% 
  slice(1:2331)
crime_18 <- crime_18 %>% 
  slice(1:2207)
crime_19 <- crime_19 %>% 
  slice(1:1933)

```


```{r fill-msa-names}
names(crime_11)[1] <- "msa_name"
crime_11 <- crime_11 %>% 
  mutate(year = "2011") %>% 
  fill(msa_name, .direction = "down")

names(crime_12)[1] <- "msa_name"
crime_12 <- crime_12 %>% 
  mutate(year = "2012") %>% 
  fill(msa_name, .direction = "down")

names(crime_13)[1] <- "msa_name"
crime_13 <- crime_13 %>% 
  mutate(year = "2013") %>% 
  fill(msa_name, .direction = "down")

names(crime_14)[1] <- "msa_name"
crime_14 <- crime_14 %>% 
  mutate(year = "2014") %>% 
  fill(msa_name, .direction = "down")

names(crime_15)[1] <- "msa_name"
crime_15 <- crime_15 %>% 
  mutate(year = "2015") %>% 
  fill(msa_name, .direction = "down")

names(crime_16)[1] <- "msa_name"
crime_16 <- crime_16 %>% 
  mutate(year = "2016") %>% 
  fill(msa_name, .direction = "down")

names(crime_17)[1] <- "msa_name"
crime_17 <- crime_17 %>% 
  mutate(year = "2017") %>% 
  fill(msa_name, .direction = "down")

names(crime_18)[1] <- "msa_name"
crime_18 <- crime_18 %>% 
  mutate(year = "2018") %>% 
  fill(msa_name, .direction = "down")

names(crime_19)[1] <- "msa_name"
crime_19 <- crime_19 %>% 
  mutate(year = "2019") %>% 
  fill(msa_name, .direction = "down")
```

```{r combine-data}
all_crimes <- full_join(crime_11, crime_12)
all_crimes <- full_join(all_crimes, crime_13)
all_crimes <- full_join(all_crimes, crime_14)
all_crimes <- full_join(all_crimes, crime_15)
all_crimes <- full_join(all_crimes, crime_16)
all_crimes <- full_join(all_crimes, crime_17)
all_crimes <- full_join(all_crimes, crime_18)
all_crimes <- full_join(all_crimes, crime_19) #can solve forcible rape/rape1 problem by just changing rape1 name to forcible rape
```

```{r wrangle-all-crimes}
names(all_crimes)[2] <- "cities"
names(all_crimes)[4] <- "violent_crime"
names(all_crimes)[9] = "property_crime"
all_crimes <- all_crimes %>% 
  filter(is.na(cities) == TRUE | cities == "Rate per 100,000 inhabitants") %>% 
  fill(Population, .direction = "down") %>% 
  filter(is.na(cities) == FALSE) %>% 
  select(msa_name, Population, violent_crime, property_crime, year)

all_crimes$msa_name <- str_split(all_crimes$msa_name, " M.S.A.", 
                                 simplify = TRUE)[,1]
  
```

```{r}
all_crimes %>% 
  count(msa_name, sort = TRUE) %>% 
  filter(msa_name == "Denver-Aurora-Broomfield, CO")
```

