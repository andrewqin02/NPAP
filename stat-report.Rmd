---
title: "Statistical Report on Qualified Immunity"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

## Setup

```{r load-packages, message = FALSE}
library(tidyverse)
library(knitr)
library(rvest)
library(lubridate)
library(infer)
library(tm)
library(broom)
library(Synth)
set.seed(460)
```

```{r load-data}
co_offenses <- read_csv("data/crime.csv")
wa_offenses <- read_csv("data/SPD_Crime_Data__2008-Present.csv")
mn_offenses18 <- read_csv("data/Police_Incidents_2018_PIMS.csv")
mn_offenses19 <- read_csv("data/Police_Incidents_2019.csv")
mn_offenses20 <- read_csv("data/Police_Incidents_2020.csv")
mn_offenses21 <- read_csv("data/Police_Incidents_2021.csv")
tx_offenses19 <- read_csv("data/houston_nibrs_2019.csv")
tx_offenses20 <- read_csv("data/houston_nibrs_2020.csv")
tx_offenses21 <- read_csv("data/houston_nibrs_2021.csv")
cspd <- read_csv("data/Crime_Level_Data.csv")
fspd_offenses <- read_csv("data/fspd_offenses.csv")
nibrs_conversion <- read_csv("fbi/NIBRS_OFFENSE_TYPE.csv")
champaign21 <- read_csv("data/2021_champaign.csv")
champaign20 <- read_csv("data/2020_champaign.csv")
champaign19 <- read_csv("data/2019_champaign.csv")
austin_offenses <- read_csv("data/Crime_Reports.csv")
full_database <- read_csv("data/crime_database.csv")
synth_complete <- readRDS("data/denver_violent_synth.Rdata")
synth_complete_test <- readRDS("data/denver_violent_true.Rdata")
synth_denver_property <- readRDS("data/denver_property_synth.Rdata")
synth_denver_property_test <- readRDS("data/denver_property_true.Rdata")
```

```{r add-dates}
dates <- str_split(co_offenses$FIRST_OCCURRENCE_DATE, " ", simplify = TRUE)
dates <- dates[,1]
year <- str_split(dates, "/", simplify = TRUE)
month <- year[,1]
year <- year[,3]
dates <- tibble(date = dates, month = month, year = year)
co_offenses <- tibble(co_offenses, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my))

co_offenses <- co_offenses %>% 
  mutate(violent = if_else(OFFENSE_CATEGORY_ID == "aggravated-assault" | 
           OFFENSE_CATEGORY_ID == "murder" & 
             OFFENSE_TYPE_ID != "homicide-negligent" | 
           OFFENSE_CATEGORY_ID == "robbery" | 
           OFFENSE_CATEGORY_ID == "sexual-assault", 1, 0)) %>% 
  mutate(property = if_else(OFFENSE_CATEGORY_ID == "arson" |
                              OFFENSE_CATEGORY_ID == "auto-theft" |
                              OFFENSE_CATEGORY_ID == "burglary" | 
                              OFFENSE_CATEGORY_ID == "larceny" |
                              OFFENSE_CATEGORY_ID == "theft-from-motor-vehicle", 
                            1, 0))

daily_totals <- co_offenses %>% 
  filter(IS_CRIME == 1) %>% 
  count(date)

monthly_totals <- co_offenses %>% 
  filter(IS_CRIME == 1) %>% 
  mutate(my = as.Date(my)) %>% 
  count(my)

co_violent <- co_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

co_limited_violent <- co_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

co_limited_property <- co_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

co_monthly_violent <- co_offenses %>% 
  filter(violent == 1) %>% 
  count(my) %>% 
  mutate(time_period = case_when(
   my < as.Date("2020-06-19") ~ "before_qi",
    my >= as.Date("2020-06-19") ~ "after_qi"
  ))

co_monthly_property <- co_offenses %>% 
  filter(property == 1) %>% 
  count(my) %>% 
  mutate(time_period = case_when(
   my < as.Date("2020-06-19") ~ "before_qi",
    my >= as.Date("2020-06-19") ~ "after_qi"
  ))

co_property_totals <- co_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

```

```{r cspd-wrangling}
names(cspd)[4] <- 'date'
names(cspd)[7] <- 'crime_against'
names(cspd)[11] <- 'description'

dates <- str_split(cspd$date, " ", simplify = TRUE)
dates <- dates[,1]
year <- str_split(dates, "/", simplify = TRUE)
month <- year[,1]
year <- year[,3]
dates <- tibble(date = dates, month = month, year = year)
cspd <- cspd[-4]
cspd <- tibble(cspd, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my))

cspd <- cspd %>% 
  mutate(violent = if_else(description == "Aggravated Assault" | 
                             description == "Murder and Non-Negligent Manslaughter" | 
                             description == "Robbery" | 
                             description == "Sexual Assault With An Object" | 
                             description == "Forcible Fondling" |
                             description == "Forcible Rape" | 
                             description == "Forcible Sodomy", 1, 0)) %>% 
  mutate(property = if_else(description == "All Other Larceny" | 
                              description == "Arson" |
                              description == "Burglary/Breaking & Entering" | 
                              description == "Destruction/Damage/Vandalism of Property" | 
                              description == "Motor Vehicle Theft" | 
                              description == "Pocket-Picking" | 
                              description == "Shoplifting" | 
                              description == "Stolen Property Offenses" | 
                              description == "Theft From Building" | 
                              description == "Theft From Coin-Operated Device" | 
                              description == "Theft From Motor Vehicle" | 
                              description == "Theft Of Motor Vehicle Parts" |
                              description == "Purse-Snatching", 1, 0))

cspd_violent <- cspd %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

cspd_monthly_violent <- cspd %>% 
  filter(violent == 1) %>% 
  count(my) %>% 
  mutate(time_period = case_when(
   my < as.Date("2020-06-19") ~ "before_qi",
    my >= as.Date("2020-06-19") ~ "after_qi"
  ))

cspd_property <- cspd %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

cspd_monthly_property <- cspd %>% 
  filter(property == 1) %>% 
  count(my) %>% 
  mutate(time_period = case_when(
   my < as.Date("2020-06-19") ~ "before_qi",
    my >= as.Date("2020-06-19") ~ "after_qi"
  ))
```



```{r add-date-wa}
names(wa_offenses)[3] <- 'date'
names(wa_offenses)[7] <- 'crime_against'
names(wa_offenses)[8] <- 'offense_parent_group'
names(wa_offenses)[9] <- 'offense'
names(wa_offenses)[10] <- 'offense_code'
names(wa_offenses)[6] <- 'group_a_b'

wa_offenses$date <- str_split(wa_offenses$date, " ", simplify = TRUE)[,1] # Get rid of time

dates <- str_split(wa_offenses$date, "/", simplify = TRUE)
month <- dates[,1]
year <- dates[,3]
dates <- tibble(month = month, year = year)
wa_offenses <- tibble(wa_offenses, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my)) # convert to date format

wa_offenses <- wa_offenses %>% 
  mutate(violent = ifelse(offense == "Aggravated Assault" | 
           offense == "Murder & Nonnegligent Manslaughter" | 
           offense == "Rape" | 
           offense == "Robbery" |
           offense == "Sexual Assault With An Object" | 
             offense == "Fondling" | 
             offense == "Sodomy", 1, 0)) %>% 
  mutate(property = ifelse(offense == "All Other Larceny" | 
                             offense == "Arson" | 
                             offense == "Burglary/Breaking & Entering" |
                             offense == "Motor Vehicle Theft" | 
                             offense == "Shoplifting" | 
                             offense == "Stolen Property Offenses" | 
                             offense == "Pocket-picking" |
                             offense == "Theft From Building" | 
                             offense == "Theft From Coin-Operated Machine or Device" | 
                             offense == "Theft From Motor Vehicle" | 
                             offense == "Theft of Motor Vehicle Parts or Accessories" | 
                             offense == "Destruction/Damage/Vandalism of Property" | 
                             offense == "Purse-snatching", 1, 0))
daily_totals_wa <- wa_offenses %>% 
  filter(offense_parent_group != "DRIVING UNDER THE INFLUENCE") %>% 
  filter(date >= as.Date("2016-01-01")) %>% 
  count(date)

monthly_totals_wa <- wa_offenses %>% 
  filter(offense_parent_group != "DRIVING UNDER THE INFLUENCE") %>%
  filter(date >= as.Date("2016-01-01")) %>% 
  count(my) 

wa_monthly_violent <- wa_offenses %>% 
    filter(violent == 1) %>% 
  count(my) %>% 
  rename(wa_n = n)
  

wa_violent <- wa_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

wa_limited_violent <- wa_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

wa_property <- wa_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

wa_limited_property <- wa_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

wa_monthly_property <- wa_offenses %>% 
    filter(property == 1) %>% 
  count(my) %>% 
  rename(wa_n = n)
```

```{r houston-wrangling}
names(tx_offenses19)[2] <- "date"
names(tx_offenses19)[3] <- "hour"
names(tx_offenses19)[4] <- "class"
names(tx_offenses19)[5] <- "description"
names(tx_offenses19)[6] <- "offense_count"
names(tx_offenses20)[2] <- "date"
names(tx_offenses20)[3] <- "hour"
names(tx_offenses20)[4] <- "class"
names(tx_offenses20)[5] <- "description"
names(tx_offenses20)[6] <- "offense_count"
names(tx_offenses21)[2] <- "date"
names(tx_offenses21)[3] <- "hour"
names(tx_offenses21)[4] <- "class"
names(tx_offenses21)[5] <- "description"
names(tx_offenses21)[6] <- "offense_count"

tx_offenses19 <- tx_offenses19 %>% 
  select(-14)

tx_offenses <- full_join(tx_offenses19, tx_offenses20)
tx_offenses <- full_join(tx_offenses, tx_offenses21)

dates <- str_split(tx_offenses$date, "/", simplify = TRUE)
month <- dates[,1]
year <- dates[,3]
dates <- tibble(month = month, year = year)
tx_offenses <- tibble(tx_offenses, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my)) # convert to date format

tx_offenses <- tx_offenses %>% 
  select(date, description, my) %>% 
  mutate(violent = ifelse(description == "Aggravated Assault" | 
           description == "Murder, non-negligent" | 
           description == "Forcible rape" | 
           description == "Robbery" |
           description == "Sexual assault with an object" | 
             description == "Forcible fondling" | 
             description == "Forcible sodomy", 1, 0)) %>% 
  mutate(property = ifelse(description == "All other larceny" | 
                             description == "Arson" | 
                             description == "Burglary, Breaking and Entering" |
                             description == "Theft from motor vehicle" | 
                             description == "Shoplifting" | 
                             description == "Stolen property offenses" | 
                             description == "Pocket-picking" |
                             description == "Theft from building" | 
                             description == "From coin-operated machine or device" | 
                             description == "Motor vehicle theft" | 
                             description == "Theft of motor vehicle parts or accessory" | 
                             description == "Destruction, damage, vandalism" | 
                             description == "Purse-snatching", 1, 0)) 

tx_violent <- tx_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

tx_monthly_violent <- tx_offenses %>% 
    filter(violent == 1) %>% 
  count(my) %>% 
  rename(tx_n = n)

tx_property <- tx_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

tx_monthly_property <- tx_offenses %>% 
    filter(property == 1) %>% 
  count(my) %>% 
  rename(tx_n = n)
```

```{r austin-wrangling}
names(austin_offenses)[6] <- "date"
names(austin_offenses)[22] <- "description"

austin_offenses <- austin_offenses %>% 
  filter(is.na(date) == FALSE)

dates <- str_split(austin_offenses$date, "/", simplify = TRUE)
month <- dates[,1]
year <- dates[,3]
dates <- tibble(month = month, year = year)
austin_offenses <- tibble(austin_offenses, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my)) # convert to date format

austin_offenses <- austin_offenses %>% 
  mutate(violent = ifelse(description == "Aggravated Assault" | 
           description == "Murder" | 
           description == "Rape" | 
           description == "Robbery", 1, 0)) %>% 
  mutate(property = ifelse(description == "Auto Theft" | 
                             description == "Burglary" | 
                             description == "Theft", 1, 0))

austin_violent <- austin_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

austin_limited_violent <- austin_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

austin_property <- austin_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

austin_limited_property <- austin_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

austin_monthly_property <- austin_offenses %>% 
    filter(property == 1) %>% 
  count(my) %>% 
  rename(austin_n = n)

austin_monthly_violent <- austin_offenses %>% 
    filter(violent == 1) %>% 
  count(my) %>% 
  rename(austin_n = n)
```


```{r fspd-wrangling}
names(fspd_offenses)[2] <- "date"
names(nibrs_conversion)[2] <- "IBRCode"

nibrs_conversion <- nibrs_conversion %>% 
  select(IBRCode, OFFENSE_NAME, CRIME_AGAINST)

fspd_offenses <- full_join(fspd_offenses, nibrs_conversion, by = "IBRCode")

dates <- str_split(fspd_offenses$date, "/", simplify = TRUE)
month <- dates[,1]
year <- dates[,3]
dates <- tibble(month = month, year = year)
fspd_offenses <- tibble(fspd_offenses, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my)) # convert to date format

fspd_offenses <- fspd_offenses %>% 
  mutate(violent = ifelse(OFFENSE_NAME == "Aggravated Assault" | 
           OFFENSE_NAME == "Murder & Nonnegligent Manslaughter" | 
           OFFENSE_NAME == "Rape" | 
           OFFENSE_NAME == "Robbery" |
           OFFENSE_NAME == "Sexual Assault With An Object" | 
             OFFENSE_NAME == "Fondling" | 
             OFFENSE_NAME == "Sodomy", 1, 0)) %>% 
  mutate(property = ifelse(OFFENSE_NAME == "All Other Larceny" | 
                             OFFENSE_NAME == "Arson" | 
                             OFFENSE_NAME == "Burglary/Breaking & Entering" |
                             OFFENSE_NAME == "Motor Vehicle Theft" | 
                             OFFENSE_NAME == "Shoplifting" | 
                             OFFENSE_NAME == "Stolen Property Offenses" | 
                             OFFENSE_NAME == "Pocket-picking" |
                             OFFENSE_NAME == "Theft From Building" | 
                             OFFENSE_NAME == "Theft From Coin-Operated Machine or Device" | 
                             OFFENSE_NAME == "Theft From Motor Vehicle" | 
                             OFFENSE_NAME == "Theft of Motor Vehicle Parts or Accessories" | 
                             OFFENSE_NAME == "Destruction/Damage/Vandalism of Property" | 
                             OFFENSE_NAME == "Purse-snatching", 1, 0))


daily_totals_fspd <- fspd_offenses %>% 
  filter(date >= as.Date("2016-01-01")) %>% 
  count(date)

monthly_totals_fspd <- fspd_offenses %>% 
  filter(date >= as.Date("2016-01-01")) %>% 
  count(my) 

fspd_monthly_violent <- fspd_offenses %>% 
    filter(violent == 1) %>% 
  count(my) %>% 
  rename(fspd_n = n)

fspd_violent <- fspd_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE) 

add_dates <- co_violent %>% 
  select(date, time_period)

antijoin <- anti_join(add_dates, fspd_violent) %>% 
  mutate(n = 0)

fspd_violent <- full_join(antijoin, fspd_violent) %>% 
  arrange(date)

fspd_limited_violent <- fspd_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

add_dates <- co_limited_violent %>% 
  select(date, time_period)

antijoin <- anti_join(add_dates, fspd_limited_violent) %>% 
  mutate(n = 0)

fspd_limited_violent <- full_join(antijoin, fspd_limited_violent) %>% 
  arrange(date)

fspd_property <-fspd_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

fspd_limited_property <- fspd_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

fspd_monthly_property <- fspd_offenses %>% 
    filter(property == 1) %>% 
  count(my) %>% 
  rename(fspd_n = n)

```


```{r champaign-wrangling}
il_offenses <- full_join(champaign19, champaign20)
il_offenses <- full_join(il_offenses, champaign21)

names(il_offenses)[1] <- 'date'
names(il_offenses)[2] <- 'description'

year <- str_split(il_offenses$date, "/", simplify = TRUE)
month <- year[,1]
year <- year[,3]
dates <- tibble(month = month, year = year)
il_offenses <- tibble(il_offenses, dates) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my))

il_offenses <- il_offenses %>% 
  mutate(violent = if_else(description == "ARSON" | 
                             description == "ARSON-AGGRAVATED" | 
                             description == "ASSAULT-AGGRAVATED" | 
                             description == "MURDER-FIRST DEGREE" | 
                             description == "MURDER-SECOND DEGREE" |
                             description == "PREDATORY CRIM SEX ASSAULT OF CHILD" | 
                             description == "SEXUAL ABUSE-AGGRAVATED" | 
                             description == "SEXUAL ABUSE-CRIMINAL" |
                             description == "SEXUAL ASSAULT-AGG CRIMINAL" | 
                             description == "SEXUAL EXPLOITATION OF A CHILD" |
                             description == "SEXUAL-ASSAULT-CRIMINAL" |
                             description == "SEXUAL ABUSE-AGGRAVATED" | 
                             description == "VIOL CHILD MURDERER/VIOLENT OFF ACT" |
                             description == "ROBBERY" |
                              description == "ROBBERY-AGGRAVATED" |
                            description == "ROBBERY-ARMED"
                           , 1, 0)) %>% 
  mutate(property = if_else(description == "BURGLARY" | 
                              description == "CRIMINAL DAMAGE GOVT SUPPORT PROP" |
                              description == "BURGLARY FROM MOTOR VEHICLE" | 
                              description == "BURGLARY MOTOR VEH PARTS & ACCESS" | 
                              description == "BURGLARY RESIDENTIAL" | 
                              description == "CRIMINAL DAMAGE TO PROPERTY" | 
                              description == "CRIMINAL DEFACEMENT OF PROPERTY" | 
                              description == "DAMAGE TO CITY PROPERTY" | 
                              description == "DAMAGING PROPERTY" | 
                              description == "POCKET-PICKING" | 
                              description == "RETAIL THEFT" | 
                              description == "THEFT $500 AND UNDER" |
                              description == "THEFT BY LESSEE" |
                              description == "THEFT FROM COIN-OP MACHINE/DEVICE" |
                              description == "THEFT FROM MOTOR VEHICLE" |
                              description == "THEFT GENERALLY" |
                              description == "THEFT OF LOST/MISLAID PROP" |
                              description == "THEFT OF LOST/MISLAID PROPERTY" |
                              description == "THEFT OF MOTOR VEH PARTS & ACCESS" |
                              description == "THEFT OVER $500" |
                              description == "THEFT-AGG IDENTITY" |
                              description == "THEFT-IDENTITY" |
                              description == "THEFT-LABOR OR SERVICES" |
                              description == "THEFT-LOST/MISLAID PROPERTY" |
                              description == "THEFT-MOTOR VEHICLE" |
                              description == "THEFT-RETAIL" |
                              description == "THEFT-AGG IDENTITY", 1, 0))

il_violent <- il_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

add_dates <- co_violent %>% 
  select(date, time_period)

antijoin <- anti_join(add_dates, il_violent) %>% 
  mutate(n = 0)

il_violent <- full_join(antijoin, il_violent) %>% 
  arrange(date)

il_monthly_violent <- il_offenses %>% 
    filter(violent == 1) %>% 
  count(my) %>% 
  rename(il_n = n)

il_monthly_property <- il_offenses %>% 
    filter(property == 1) %>% 
  count(my) %>% 
  rename(il_n = n)

il_limited_violent <- il_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

add_dates <- co_limited_violent %>% 
  select(date, time_period)

antijoin <- anti_join(add_dates, il_limited_violent) %>% 
  mutate(n = 0)

il_limited_violent <- full_join(antijoin, il_limited_violent) %>% 
  arrange(date)

il_limited_property <- il_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-05-31") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-01") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

add_dates <- co_limited_violent %>% 
  select(date, time_period)

antijoin <- anti_join(add_dates, il_limited_property) %>% 
  mutate(n = 0)

il_limited_property <- full_join(antijoin, il_limited_property) %>% 
  arrange(desc(date))



il_property <- il_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

add_dates <- co_violent %>% 
  select(date, time_period)

antijoin <- anti_join(add_dates, il_property) %>% 
  mutate(n = 0)

il_property <- full_join(antijoin, il_property) %>% 
  arrange(date)
```




```{r mn-wrangling, message = FALSE}
mn_offenses18 <- mn_offenses18 %>% 
  mutate(precinct = as.character(precinct))
mn_offenses21 <- mn_offenses21 %>% 
  mutate(precinct = as.character(precinct))
mn_offenses <- full_join(mn_offenses18, mn_offenses19)
mn_offenses <- full_join(mn_offenses, mn_offenses20)
mn_offenses <- full_join(mn_offenses, mn_offenses21)

mn_offenses$reportedDate <- str_split(mn_offenses$reportedDate, " ", 
                                      simplify = TRUE)[,1] # Get rid of time

dates <- str_split(mn_offenses$reportedDate, "/", simplify = TRUE)
month <- dates[,2]
year <- dates[,1]
dates <- tibble(month = month, year = year)
mn_offenses <- tibble(mn_offenses, dates) %>% 
  mutate(reportedDate = ymd(reportedDate)) %>% 
  mutate(my = paste0(month, "-01-", year)) %>% 
  mutate(my = mdy(my)) # convert to date format

names(mn_offenses)[6] = "date"
mn_offenses <- mn_offenses %>% 
  mutate(violent = ifelse(
    UCRCode == "01" | UCRCode == "05" & description != "OBS - ASLT-POLICE/EMERG P" 
    & description != "ASLT 4-LESS THAN SUBST HARM" & 
      description != "DISARM A POLICE OFFICER" | UCRCode == "03" | UCRCode == "04" |
    description == "ROBBERY INCLUDING AUTO THEFT", 1, 0)) %>% 
  mutate(property = ifelse(UCRCode == "06" | UCRCode == "07" | UCRCode == "08" | 
                             UCRCode == "10", 1, 0))

mn_violent <- mn_offenses %>% 
  filter(violent == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)

mn_property_totals <- mn_offenses %>% 
  filter(property == 1) %>% 
  count(date) %>% 
  mutate(time_period = case_when(
    date >= as.Date("2019-06-19") & date < as.Date("2020-06-19") ~ "2019-20",
    date >= as.Date("2020-06-19") & date < as.Date("2021-06-20") ~ "2020-21"
  )) %>% 
  filter(is.na(time_period) == FALSE)
```

```{r synthetic-control-setup}
reduced_database <- full_database %>% 
  filter(population >= 50000) %>% 
  filter(is.na(NAME) == FALSE)
```

```{r remove-duplicates-synthetic, message = FALSE}
for_removal <- reduced_database %>% 
  filter(NAME == "Burbank, California") %>% 
  filter(white_percent < 40)

for_removal2 <- reduced_database %>% 
  filter(NAME == "Mesquite, Texas") %>% 
  filter(white_percent == 0.0)
for_removal <- full_join(for_removal, for_removal2)

for_removal2 <- reduced_database %>% 
  filter(NAME == "Mountain View, California") %>% 
  filter(white_percent > 48)
for_removal <- full_join(for_removal, for_removal2)

for_removal2 <- reduced_database %>% 
  filter(NAME == "Plantation, Florida") %>% 
  filter(white_percent > 90)
for_removal <- full_join(for_removal, for_removal2)

reduced_database <- anti_join(reduced_database, for_removal)
```

```{r reduced-violent}
reduced_database_violent <- reduced_database %>% 
  filter(is.na(violent_crime_rate) == FALSE & is.na(female_household) == FALSE & 
         is.na(hs) == FALSE & is.na(res_stability) == FALSE & is.na(over_18) == FALSE & 
         is.na(white_percent) == FALSE & is.na(self_employed) == FALSE & is.na(unemployment) == FALSE & 
         is.na(median_income) == FALSE & is.na(child_poverty) == FALSE & is.na(owner_occupied) == FALSE)
counts <- reduced_database_violent %>% 
  count(NAME, sort = TRUE)
remove_missing <- counts %>% 
  filter (n < 9)
reduced_database2 <- anti_join(reduced_database_violent, remove_missing)

add_numbers_violent <- reduced_database2 %>% 
  filter(NAME == "Denver, Colorado" | NAME == "Colorado Springs, Colorado" | state != "Colorado") %>% 
  distinct(NAME) 

add_numbers_violent <- add_numbers_violent %>% 
  mutate(id = 1:nrow(add_numbers_violent))

reduced_database2 <- full_join(reduced_database2, add_numbers_violent, by = "NAME")

no_colorado <- reduced_database2 %>% 
  filter(NAME == "Denver, Colorado" | NAME == "Colorado Springs, Colorado" | state != "Colorado") %>% 
  mutate(id = as.numeric(id)) 
no_colorado <- no_colorado %>% 
  mutate(year = as.numeric(year)) 
no_colorado <- as.data.frame(no_colorado)

```

```{r reduced-property}
reduced_database_property <- reduced_database %>% 
  filter(is.na(property_crime_rate) == FALSE 
         & is.na(population) == FALSE & 
           is.na(female_household) == FALSE & is.na(hs) == FALSE & 
           is.na(res_stability) == FALSE & is.na(over_18) == FALSE & 
         is.na(white_percent) == FALSE & is.na(self_employed) == FALSE & is.na(unemployment) == FALSE & 
         is.na(median_income) == FALSE & is.na(child_poverty) == FALSE & is.na(owner_occupied) == FALSE)
counts <- reduced_database_property %>% 
  count(NAME, sort = TRUE)
remove_missing <- counts %>% 
  filter (n < 9)
reduced_database2 <- anti_join(reduced_database_property, remove_missing)

add_numbers <- reduced_database2 %>% 
  filter(NAME == "Denver, Colorado" | NAME == "Colorado Springs, Colorado" | state != "Colorado") %>% 
  distinct(NAME) 

add_numbers <- add_numbers %>% 
  mutate(id = 1:nrow(add_numbers))

reduced_database2 <- full_join(reduced_database2, add_numbers, by = "NAME")

no_colorado1 <- reduced_database2 %>% 
  filter(NAME == "Denver, Colorado" | NAME == "Colorado Springs, Colorado" | state != "Colorado") %>% 
  mutate(id = as.numeric(id)) 
no_colorado1 <- no_colorado1 %>% 
  mutate(year = as.numeric(year)) 
no_colorado1 <- as.data.frame(no_colorado1)
```

```{r create-weighted-average}
t1 <- co_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)
t2 <- co_violent %>% 
  filter(time_period == "2020-21") %>%
  rename("p2" = n)

combined_analysis <- tibble(t1, t2) %>% 
  mutate(diff = (p2 - p1) / sum(p1)) %>% 
  mutate(jurisdiction = "Denver") %>% 
  select(diff, jurisdiction, date)

wat1 <- wa_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- wa_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysiswa <- tibble(wat1, wat2) %>% 
  mutate(seattle_diff = (p2 - p1) / sum(p1)) %>% 
  select(seattle_diff, date)

wat1 <- tx_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- tx_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysistx <- tibble(wat1, wat2) %>% 
  mutate(tx_diff = (p2 - p1) / sum(p1)) %>% 
  select(tx_diff)

wat1 <- fspd_violent %>%
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n) 

wat2 <- fspd_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysisfspd <- tibble(wat1, wat2) %>% 
  mutate(fspd_diff = (p2 - p1) / sum(p1)) %>% 
  select(fspd_diff) 

wat1 <- il_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- il_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysisil <- tibble(wat1, wat2) %>% 
  mutate(il_diff = (p2 - p1) / sum(p1)) %>% 
  select(il_diff)

synthetic <- tibble(combined_analysiswa, combined_analysistx, combined_analysisfspd, 
                    combined_analysisil, .name_repair = "universal") %>% 
  mutate(diff = seattle_diff * 0.496466442 + tx_diff * 0.004280705 + fspd_diff * 0.487715311 + 
           il_diff * 0.011537542) %>% 
  mutate(jurisdiction = "Synthetic Control")  %>% 
  select(diff, jurisdiction, date)

combined_synthetic_violent <- full_join(combined_analysis, synthetic)
```



```{r create-weighted-average-property}
t1 <- co_property_totals %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)
t2 <- co_property_totals %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysis <- tibble(t1, t2) %>% 
  mutate(diff = (p2 - p1) / sum(p1)) %>% 
  mutate(jurisdiction = "Denver") %>% 
  select(diff, jurisdiction, date)

wat1 <- wa_property %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- wa_property %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysiswa <- tibble(wat1, wat2) %>% 
  mutate(seattle_diff = (p2 - p1) / sum(p1)) %>% 
  select(seattle_diff, date)

wat1 <- austin_property %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- austin_property %>% 
  filter(time_period == "2020-21") %>% 
  select(n) %>% 
  rename("p2" = n)

combined_analysistx <- tibble(wat1, wat2) %>% 
  mutate(tx_diff = (p2 - p1) / sum(p1)) %>% 
  select(tx_diff)

wat1 <- fspd_property %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- fspd_property %>% 
  filter(time_period == "2020-21") %>% 
  select(n) %>% 
  rename("p2" = n)

combined_analysisfspd <- tibble(wat1, wat2) %>% 
  mutate(fspd_diff = (p2 - p1) / sum(p1)) %>% 
  select(fspd_diff)

wat1 <- il_property %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- il_property %>% 
  filter(time_period == "2020-21") %>% 
  select(n) %>% 
  rename("p2" = n)

combined_analysisil <- tibble(wat1, wat2) %>% 
  mutate(il_diff = (p2 - p1) / sum(p1)) %>% 
  select(il_diff)

synthetic <- tibble(combined_analysiswa, combined_analysistx, combined_analysisfspd, 
                    combined_analysisil) %>% 
  mutate(diff = seattle_diff * 0.08747524 + tx_diff * 0.6935988 + fspd_diff * 0.00004654831 + 
           il_diff * 0.2188792) %>% # Excluded Houston due to extremely small weight
  mutate(jurisdiction = "Synthetic Control")  %>% 
  select(diff, jurisdiction, date)

combined_synthetic_property <- full_join(combined_analysis, synthetic)
```

## Introduction and Background

Qualified immunity is a court-established doctrine that shields government officials from personal liability for constitutional violations unless the officials violated clearly established laws (https://www.lawfareblog.com/what-qualified-immunity-and-what-does-it-have-do-police-reform). After the killing of George Floyd sparked movements against police violence around the country, many activists directed their attention towards qualified immunity as a subject of reform. Activists argued that qualified immunity prevents police officers from being held accountable for excessive uses of force within civil court. Supporters of qualified immunity argued that efforts to limit qualified immunity would prevent police officers from effectively carrying out their job out of fear of frivolous lawsuits. In this statistical report, we aim to provide preliminary data-driven insights on the effects of recently passed qualified immunity reform on violent and property crime rates in major urban jurisdictions.

Four states have passed measures to limit qualified immunity: Colorado, Connecticut, New Mexico, and New York. Of those states, Colorado passed its reform the earliest, with its measure taking effect June 19, 2020. As a result, we decided to analyze Colorado crime data to determine the effects of qualified immunity on crime rates. In particular, our research question is as follows: Was the passage of qualified immunity reform in Colorado in June of 2020 correlated with significantly larger proportional increases in average daily violent and property crime incidents than increases in control jurisdictions? Because statewide incident-level data for 2020 and 2021 YTD from Colorado was not publicly available, we further narrowed the scope of our analysis to Denver and Colorado Springs, the two largest jurisdictions within Colorado.

Although we attempt to establish some level of causation in this study through the use of a synthetic control method, we lack the volume of observational data needed to successfully establish causation. In particular, we are missing observations on several key lurking variables, including the effects of COVID on poverty rates in each jurisdiction, 2020 and 2021 census data, community attitudes towards policing as a result of the George Floyd protests, amidst several others. Much of this data will only be released a few years from now, severely limiting the contours of the present analysis. However, due to the prescience of the qualified immunity question and the need for data within the debate, we decided to produce this preliminary report to at least illustrate the plausible effects of qualified immunity on crime rates in Colorado. None of the findings in this report should be interpreted as demonstrating a conclusive causal relationship between qualified immunity reform and crime.

## Methodology

In this study, we utilized a synthetic control method as described by Abadie in his article "Using Synthetic Controls: Feasibility, Data Requirements, and Methodological Aspects." In a synthetic control method, researchers create a weighted average of jurisdictions and data points with the goal of minimizing the distance between the weighted average and the true jurisdiction's pre-treatment predictor and response values. The synthetic control method has the advantage of systematically identifying the strongest control jurisdictions based on predictor numbers over time, as opposed to manually identifying a geographically close jurisdiction and claiming the existence of sufficient connection to isolate the effects of the policy intervention, thus removing the effects of researcher bias from the analysis. Generally, the synthetic control method is then followed by a series of placebo synthetic control constructions to determine if the post-treatment to pre-treatment RMSPE (root mean squared prediction error) ratio for the treated jurisdiction is extreme compared to those of placebo synthetic controls (https://mixtape.scunning.com/synthetic-control.html). If employed successfully, the synthetic control method can successfully prove the existence of a causal connection between different variables.

In practice, however, we faced critical data limitations that made it impossible to run the most statistically robust version of the synthetic control method. Because we lacked widely available 2020-21 post-treatment crime and census data (we only had that data for very specific jurisdictions), we could not create a series of placebo synthetic controls with post-treatment RMSPE values to compare the RMSPE ratio for the treated jurisdiction with. In addition, we only had access to a very small number of time periods (2011-19) and included an enormous sample of jurisdictions within the donor pool (many of which were substantially different from the treated jurisdictions) due to the rarity by which we could obtain data from police departments, significantly increasing the potential for bias. To continue the data analysis under these limitations, we primarily utilized the synthetic control methodology to identify similar jurisdictions to Denver or Colorado Springs and to provide weights for some of those jurisdictions.

Because no database of city predictors and violent/property crime rates over 2011-2019 previously existed, we created a new database from scratch. Using ACS census data from 2011 to 2019, we recorded each jurisdiction's name, single female-led family household percentage, percentage of the population who graduated high school, percentage of the population who lived in the same house they lived in a year ago, percentage of the population who were over 18, percentage of the population who were white, percentage of the population who were self-employed, unemployment rate, median income, child poverty rate, and the percentage of housing units occupied by their owners. Each of these predictors had been identified as possible or significant predictors of crime within metropolitan and nonmetropolitan counties in a study published by researchers Wells and Weishelt (Explaining Crime in Metropolitan and Non-Metropolitan Counties). We then combined the city predictor data with violent crime, property crime, and population statistics from UCR Crime in the United States fact tables. Our final full database included over 83000 observations and 20 variables, each observation representing a jurisdiction at a particular year. We then filtered the database to only include cities above 50000 in population to remove small rural jurisdictions that would likely not match the dynamics of more urban areas like Denver. Additionally, we removed jurisdictions with missing data on violent/property crime rates or missing yearly data.

Since publicly available data was not available for 2020-2021 from either the UCR or the ACS, we utilized the Synth package to create a synthetic control model for Denver and Colorado Springs from 2011-2019. We optimized the synthetic control model for 2016 to 2019 to obtain jurisdictions that could follow the most recent trends in both Denver and Colorado Springs. We then identified roughly the top 5 jurisdictions with the highest weights and reran the synthetic control model with only those jurisdictions to recalculate the weights. With those identified control jurisdictions, we submitted requests for incident-level crime data from those departments for 2019-2021. When those requests were either unanswered or denied (as in the case of Ann Arbor Police Department), we removed the city from the synthetic control model and reran the model until we obtained at least four police departments with accessible incident level crime data whose plot looked at least somewhat similar to the plots of the treated jurisdictions (Denver and Colorado Springs).

We subdivided all 2019-2021 incident-level crime data into property and violent crimes based on UCR definitions. In particular, murder and nonnegligent homicide, aggravated assault, robbery, and forcible rape (including sexual assault with an object, fondling, and forcible sodomy) were identified as violent crimes. We categorized larceny charges, burglary, damage/destruction of property, arson, shoplifting, pocket-picking, and motor vehicle theft charges as property crimes. We calculated the daily numbers of violent and property offenses for June of 2019 to June of 2020 (before qualified immunity reform) and June of 2020 to June of 2021 (after qualified immunity reform) in control and treated jurisdictions. We then subtracted the daily numbers of violent and property offenses in the 2019-20 time period from the 2020-21 time period and divided by the total number of violent or property offenses in the 2019-20 time period to make the daily numbers of violent and propery crimes proportionate to each jurisdiction's respective crime numbers. Finally, we created a bootstrapped null distribution assuming no true difference between the daily increases of the synthetic jurisdiction compared to Denver or Colorado Springs and calculated a p-value based on the probability of observing the real difference or greater between Denver/Colorado Springs and the respective synthetic control difference based on the null distribution.

This methodology had a few other critical limitations. First, because of the lack of 2020 and 2021 census data, we could only identify jurisdictions similar to either Denver or Colorado Springs until 2019 which is no guarantee that those similarities in control predictors continued until 2020 and 2021. In addition, since we did not have access to UCR data for 2020 and 2021, we had to use 2011-2019 weights in 2020 and 2021 calculations, which may extrapolate beyond the capabilities of the synthetic control, since the trends between the predictor variables and the responsive crime rates may not continue into 2020 and 2021 (which also introduced other variables, such as the George Floyd protests, that influenced crime rates). Second, because of the several denied requests (such as Ann Arbor and Clarksville Police Departments), we were forced to rely partially on convenience sampling in order to successfully carry out the study. Despite this, the plots comparing the synthetic control property/violent crime rates with the Denver and Colorado Springs property/violent crime rates look strong enough to indicate that the synthetic controls at least partially match the crime trends of the treated jurisdictions even when certain jurisdictions were removed due to lack of data. Third, because we needed to determine if the increases between the 2019-20 time period and 2020-21 time period were significantly greater than increases in control jurisdictions, we were forced to employ a test where we subtracted daily crimes in one time period from daily crimes in another time period. This method may have substantially exaggerated the standard deviation of violent and property crimes, since daily fluctuations in crime do not remain constant over the course of a year. The test may have been more successful on a monthly level, but we did not have enough monthly difference data to successfully arrive at statistical conclusions through simulation. Fourth, because we had to standardize the daily crime numbers by dividing crime numbers from some relative figure for each jurisdiction (in this case, the total number of offenses in the 2019-20 time period), smaller jurisdictions disproportionately influenced the variance of the synthetic control, since daily fluctuations of 1-2 offenses were much greater proportionately to larger jurisdictions. See Appendix 1 for further details.

## Exploratory Data Analysis

We began by visualizing daily violent crime and property crime numbers in both Denver and Colorado Springs.

```{r fig.height = 4, fig.width = 6}

y_int <- co_monthly_violent %>% 
  filter(time_period == "before_qi") %>% 
  summarise(max = max(n)) %>% 
  pull()

ggplot(co_monthly_violent, aes(x = my, y = n, fill = time_period)) + 
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("red", "black")
  ) + 
  theme(legend.position = "none") + 
  labs(title = "Monthly Violent Crime Numbers in Denver 2016-2021", 
       x = "Date", 
       y = "Number of Reported Incidents") + 
  geom_hline(yintercept = y_int + 10, lty = 2)
```

The black dotted line represents 10 reported incidents above the maximum number of violent crime offenses in a single month in the four years prior to passage of qualified immunity reform. Based on the graph, 2020 did appear to have significant increases in violent crime (with 2 months surpassing the previous records for the highest number of violent crimes in a single month). However, when observing the previous 5 years of crime, the crime numbers after the passage of the police accountability bill may be interpreted as part of a steady yearly increase in violent crime numbers from 2016 to 2021. The graph also indicates the importance of controlling the effects of seasonal shifts on crime; violent crime numbers tend to peak during the hot summer months and decrease during the winter.

```{r monthly-prop-denver, fig.height = 4, fig.width = 6}
y_int <- co_monthly_property %>% 
  filter(time_period == "before_qi") %>% 
  summarise(max = max(n)) %>% 
  pull()

ggplot(co_monthly_property, aes(x = my, y = n, fill = time_period)) + 
  geom_bar(stat = "identity") + 
  scale_fill_manual(values = c("red", "black")
  ) + 
  theme(legend.position = "none") + 
  labs(title = "Monthly Property Crime Numbers in Denver 2016-2021", 
       x = "Date", 
       y = "Number of Reported Incidents") + 
  geom_hline(yintercept = y_int + 50, lty = 2)
```

The trend we observed in Denver violent crimes is remarkably turned on its head when examining property crimes. Almost every month after the passage of qualified immunity reform, we observed property crime numbers that far surpassed the previous maximum number of property offenses in a single month. The bar graph provides preliminary evidence that Denver property crimes increased substantially after the passage of the police accountability bill in June of 2020, although the bar graph also appears to depict a rise in property crime that began before the passage of the bill (April of 2020 already matched the highs of the summer months beforehand). Unfortunately, it is difficult to disentangle the effects of normal seasonal shifts and the COVID recession from the possible effects of the police accountability bill.

If the qualified immunity measures in the police accountability bill *caused* increases in property crime in Colorado, we would expect to see major property crime increases in jurisdictions throughout Colorado. To determine if Denver trends were replicated elsewhere, we included the following two graphs from Colorado Springs, despite the fact that our preliminary analysis has not gotten far enough to successfully compare Colorado Springs with a synthetic control.

```{r monthly-violent-cspd, fig.height = 4, fig.width = 6}
y_int <- cspd_monthly_violent %>% 
  filter(time_period == "before_qi") %>% 
  summarise(max = max(n)) %>% 
  pull()

ggplot(cspd_monthly_violent, aes(x = my, y = n, fill = time_period)) + 
  geom_bar(stat = "identity") + 
  scale_fill_manual(values = c("red", "black")
  ) + 
  theme(legend.position = "none") + 
  labs(title = "Monthly Violent Crime Numbers in Colorado Springs 2016-2021", 
       x = "Date", 
       y = "Number of Reported Incidents") + 
  geom_hline(yintercept = y_int + 10, lty = 2)
```

Similarly to Denver, Colorado Springs may have also experienced some increase in violent crime, although only one month after the passage of the police accountability bill surpassed the previous record for the highest number of violent crimes in a single month.

```{r monthly-property-cspd, fig.height = 4, fig.width = 6}
y_int <- cspd_monthly_property %>% 
  filter(time_period == "before_qi") %>% 
  summarise(max = max(n)) %>% 
  pull()

ggplot(cspd_monthly_property, aes(x = my, y = n, fill = time_period)) + 
  geom_bar(stat = "identity") + 
  scale_fill_manual(values = c("red", "black")
  ) + 
  theme(legend.position = "none") + 
  labs(title = "Monthly Property Crime Numbers in Colorado Springs 2016-2021", 
       x = "Date", 
       y = "Number of Reported Incidents") + 
  geom_hline(yintercept = y_int + 50, lty = 2)
```

Diverging from Denver trends, however, Colorado Springs lacked the large rise in property crime numbers that Denver saw after the passage of qualified immunity. In fact, Colorado Springs property crimes may even have decreased over the same time period. The above bar graph demonstrates the possibility that other factors specific to Denver (such as worse recessionary effects from COVID or more distrust of police offiers) may have led to (or at least exacerbated) the major increase in property crimes, as opposed to the police accountability bill having an effect. 

We then directly compared Denver's violent and property crime monthly numbers with synthetic control numbers from 2019 to 2021 (the only publicly available data) to determine if Denver's trends diverged from similar jurisdictions' crime trends.

```{r create-synthetic-control-raw-numbers, fig.height = 4, fig.width = 6}
synthetic_control_graph <- full_join(wa_monthly_violent, tx_monthly_violent, 
                                     by = "my")
synthetic_control_graph <- full_join(synthetic_control_graph, fspd_monthly_violent, 
                                     by = "my")
synthetic_control_graph <- full_join(synthetic_control_graph, il_monthly_violent, 
                                     by = "my")
sum_co <- co_monthly_violent %>% 
  filter(my >= as.Date("2019-01-01") & my <= as.Date("2021-06-01")) %>% 
  summarise(sum = sum(n)) %>% 
  pull()

synthetic_control_graph <- synthetic_control_graph %>% 
  filter(my >= as.Date("2019-01-01") & my <= as.Date("2021-06-01")) %>% 
  mutate(n = (wa_n / sum(wa_n) * 0.496466442 + tx_n / sum(tx_n) * 0.004280705 
         + fspd_n / sum(fspd_n) * 0.487715311 + 
           il_n / sum(il_n) * 0.011537542) * sum_co) %>% 
  mutate(jurisdiction = "Synthetic Control")

synthetic_control_graph <- co_monthly_violent %>% 
  filter(my >= as.Date("2019-01-01") & my <= as.Date("2021-06-01")) %>% 
  mutate(jurisdiction = "Denver") %>% 
  full_join(synthetic_control_graph) %>% 
  select(my, n, jurisdiction)

ggplot(synthetic_control_graph, aes(x = my, y = n, color = jurisdiction)) + 
  geom_line() + 
  ylim(0, 600) +
  geom_vline(xintercept = mdy("06-19-2020"), lty = 2, color = "red") + 
  labs(title = "Denver vs Control Monthly Violent Crime Numbers", 
       x = "Date", 
       y = "Number of Reported Violent Crime Incidents", 
       color = "Jurisdiction")
```

Denver's monthly violent crime incidents did not appear to vary significantly from similar jurisdictions. Although Denver experienced some increases in the summer immediately following the passage of the police accountability bill as well as some increases in the beginning of the 2021 summer not fully matched by the synthetic control, Denver's violent crime numbers one the whole appeared to closely follow many of the synthetic control numbers. 

```{r create-synthetic-control-property, fig.height = 4, fig.width = 6}
synthetic_control_graph2 <- full_join(wa_monthly_property, austin_monthly_property, 
                                     by = "my")
synthetic_control_graph2 <- full_join(synthetic_control_graph2, fspd_monthly_property, 
                                     by = "my")
synthetic_control_graph2 <- full_join(synthetic_control_graph2, il_monthly_property, 
                                     by = "my")
sum_co <- co_monthly_property %>% 
  filter(my >= as.Date("2019-01-01") & my <= as.Date("2021-06-01")) %>% 
  summarise(sum = sum(n)) %>% 
  pull()

synthetic_control_graph2 <- synthetic_control_graph2 %>% 
  filter(my >= as.Date("2019-01-01") & my <= as.Date("2021-06-01")) %>% 
  mutate(n = (wa_n / sum(wa_n) * 0.08747524 + austin_n / sum(austin_n) * 0.6935988 
         + fspd_n / sum(fspd_n) * 0.00004654831 + 
           il_n / sum(il_n) * 0.2188792) * sum_co) %>% 
  mutate(jurisdiction = "Synthetic Control")

synthetic_control_graph2 <- co_monthly_property %>% 
  filter(my >= as.Date("2019-01-01") & my <= as.Date("2021-06-01")) %>% 
  mutate(jurisdiction = "Denver") %>% 
  full_join(synthetic_control_graph2) %>% 
  select(my, n, jurisdiction)

ggplot(synthetic_control_graph2, aes(x = my, y = n, color = jurisdiction)) + 
  geom_line() + 
  geom_vline(xintercept = mdy("06-19-2020"), lty = 2, color = "red") + 
  labs(title = "Denver vs Control Monthly Property Crime Numbers", 
       x = "Date", 
       y = "Number of Reported Property Crime Incidents", 
       color = "Jurisdiction") + 
  ylim(0, 3800) # Begins deviating significantly (going above control) at June - perhaps move the red line to prevent confusion? Happened halfway through June
```

On the other hand, Denver's increase in property crime numbers was significantly greater than increases in other jurisdictions. From roughly February 2020 to July 2020, Denver property crimes steadily increased, while synthetic control numbers remained stagnant. Denver property cfrimes also remained high even after the summer, maintaining its much higher position compared to the synthetic control even as late as June of 2021. However, the graph comparing property crime numbers between Denver and the synthetic control unit is also much weaker than the violent crime graph, with the two lines significantly deviating from each other even before the passage of qualified immunity reform. The weaknesses in the graph may speak to possible dissimilarities between the synthetic control for Denver property crimes and true Denver. 

Finally, we took the daily differences between the synthetic control and Denver between the two periods (the differences that we would later simulate on) and graphed the daily proportional increases in violent and property crimes. 

```{r, fig.height = 4, fig.width = 6}
ggplot(combined_synthetic_violent, aes(y = diff, x = date, color = jurisdiction)) + 
  geom_point(alpha = 0.4) + 
  geom_smooth(alpha = 1.4, se = FALSE) + 
  theme_bw() + 
  labs(title = "Very little apparent increase in violent crimes in both Denver and control", 
       y = "Proportional Daily Differences", 
       x = "2020-21 Date", 
       color = "Jurisdiction")
```


The graph does not appear to depict any significant daliy increase in violent crimes in either Denver or the synthetic control unit. The points are relatively randomly scattered and the trendlines are both roughly at 0 except for some divergence as the summer of 2021 approached. The graph also indicates the existence of a possible outlier on June 2, 2021. Upon further examination, the point at June 2, 2021 is mostly explainable by an extremely large amount of crime in Fort Smith in June 1, 2020 (the dates don't exactly match due to the extra leap day in 2019-2020) followed by 0 crimes in June 2, 2021. Since the difference was much below any other difference values, we decided to remove the June 2, 2021/June 1, 2020 data from the analysis to prevent means from being skewed.

```{r, fig.height = 4, fig.width = 6}
ggplot(combined_synthetic_property, aes(y = diff, x = date, color = jurisdiction)) + 
  geom_point() + 
  geom_smooth() + 
  theme_bw() + 
  labs(title = "Daily increases in Denver property crimes are greater than control increases", 
       y = "Proportional Daily Differences", 
       x = "2020-21 Date", 
       color = "Jurisdiction")
```

On the other hand, daily property crimes in Denver significantly increased, while the synthetic control trendline remained roughly at 0. Thus, even when comparing synthetic control differences with Denver, Denver still experienced a much larger increase in property crimes.

## Analysis

### Synthetic Control Modelling

We began by creating the database of all census cities/towns within America from 2011-2019 that had both UCR and ACS data. From there, we filtered the database to only include cities greater than 50000 in population to identify roughly 500 similar jurisdictions to Colorado Springs and Denver. Using each jurisdiction's violent and property crime rates, we created synthetic jurisdictions based on the weighted averages of all 500 jurisdictions (weights determined through proximity to predictor and response values of the treated jurisdictions). The resulting graphs comparing the true treated units with their synthetic control models pre-treatment over 2011-19 are shown below.

```{r denver-violent-crime-synth-plot, fig.height = 4, fig.width = 6}

prep <- dataprep(foo = no_colorado, predictors = c("population", "female_household", 
                                                "hs", "res_stability", "over_18", 
                                                "white_percent", "self_employed", 
                                                "unemployment", "median_income", 
                                                "child_poverty", "owner_occupied"), 
         predictors.op = "mean", dependent = "violent_crime_rate", unit.variable = 
         "id", time.variable = "year", unit.names.variable = "NAME", 
         treatment.identifier = 186, controls.identifier = c(1:184, 187:514), 
         time.predictors.prior = 2011:2018, time.optimize.ssr = 2014:2019, 
         time.plot = 2011:2019)

path.plot(synth.res = synth_complete,
dataprep.res = prep,
Ylab = c("Violent Crime Rates"),
Xlab = c("Year"),
Legend = c("Denver, CO","Synthetic Denver")
)
```

The first graph comparing the Denver annual violent crime rates with the synthetic control model's is relatively strong, with the synthetic control model's violent crime rates roughly matching some of the trends and the level of Denver's violent crime rate pre-treatment. There are some imperfections; for instance, Denver's random yearly fluctuation isn't fully matched each year, although Denver's overall trend is roughly captured in the model. 

Due to limitations in obtaining 2020 and 2021 data, I limited the calculation of the weighted average to the top 4 jurisdictions and recalculated the synthetic model to obtain new weights (the 5th jurisdiction, Ann Arbor, denied our FOIA request). The true fit of the model to pre-treatment Denver is depicted below:

```{r denver-violent-crime-true-synth-plot, fig.height = 4, fig.width = 6}
prep_test <- dataprep(foo = no_colorado, predictors = c("population", "female_household", 
                                                "hs", "res_stability", "over_18", 
                                                "white_percent", "self_employed", 
                                                "unemployment", "median_income", 
                                                "child_poverty", "owner_occupied"), 
         predictors.op = "mean", dependent = "violent_crime_rate", unit.variable = 
         "id", time.variable = "year", unit.names.variable = "NAME", 
         treatment.identifier = 186, controls.identifier = c(496, 449, 14, 266), 
         time.predictors.prior = 2011:2019, time.optimize.ssr = 2014:2019, 
         time.plot = 2011:2019)

path.plot(synth.res = synth_complete_test,
dataprep.res = prep_test,
Ylab = c("Violent Crime Rates"),
Xlab = c("Year"),
Legend = c("Denver, CO","Synthetic Denver")
)
```

The synthetic of the 4 cities is slightly higher in terms of level but still follows the trend of true pre-treatment Denver roughly correctly. Thus, we determined the synthetic control to be similar enough to the real Denver to safely proceed with statistical testing.

```{r denver-property-crimes-synthetic-control-graph, fig.height = 4, fig.width = 6}

denver_prop_prep <- dataprep(foo = no_colorado1, predictors = c("population", "female_household", 
                                                "hs", "res_stability", "over_18", 
                                                "white_percent", "self_employed", 
                                                "unemployment", "median_income", 
                                                "child_poverty", "owner_occupied"), 
         predictors.op = "mean", dependent = "property_crime_rate", unit.variable = 
         "id", time.variable = "year", unit.names.variable = "NAME", 
         treatment.identifier = 186, controls.identifier = c(1:184, 187:531), 
         time.predictors.prior = 2011:2018, time.optimize.ssr = 2016:2019, 
         time.plot = 2011:2019)

path.plot(synth.res = synth_denver_property,
dataprep.res = denver_prop_prep,
Ylab = c("Property Crime Rates"),
Xlab = c("Year"),
Legend = c("Denver, CO","Synthetic Denver")
)
```

On the other hand, the plot comparing pre-treatment Denver and the synthetic control model for Denver indicates that the synthetic control model does not appear to be on the same level prior to 2017. From 2017 to 2019, the plot is roughly correct in comparing property crime rates, but the significant drop in the synthetic model from 2016 to 2017 indicates that the model may be somewhat limited in its explanatory potential and ability to cast a counterfactual for Denver.

Excluding Ann Arbor, we refitted the synthetic control model with the 5 most highly weighted jurisdictions.

```{r denver-property-crimes-synthetic-control-graph-true, fig.height = 4, fig.height = 6}
denver_prop_prep_test <- dataprep(foo = no_colorado1, predictors = c("population", "female_household", 
                                                "hs", "res_stability", "over_18", 
                                                "white_percent", "self_employed", 
                                                "unemployment", "median_income", 
                                                "child_poverty", "owner_occupied"), 
         predictors.op = "mean", dependent = "property_crime_rate", unit.variable = 
         "id", time.variable = "year", unit.names.variable = "NAME", 
         treatment.identifier = 186, controls.identifier = c(466, 266, 512, 14, 449), 
         time.predictors.prior = 2011:2018, time.optimize.ssr = 2016:2019, 
         time.plot = 2011:2019)

path.plot(synth.res = synth_denver_property_test,
dataprep.res = denver_prop_prep_test,
Ylab = c("Property Crime Rates"),
Xlab = c("Year"),
Legend = c("Denver, CO","Synthetic Denver")
)
```

The synthetic of the top 5 cities of the previous synthetic control model is still significantly off in terms of following the trends of Denver in terms of property crimes. This may reflect crucial limitations in the ability of the synthetic control model to account for Denver property crime trends.

### Statistical Bootstrapping Simulations

After collecting data from each of the 4-5 jurisdictions identified in each test as well as Denver and Colorado Springs, we calculated the daily differences in violent and property crime between the June 19, 2019 to June 18, 2020 time period compared to the June 19, 2020 to June 19, 2021 time period (the first time period also had an extra day from the leap year). In particular, we corresponded the dates so that the number of violent crimes on June 19, 2019 was subtracted from the number of violent crimes on June 19, 2020 and created a dataset of these differences in violent and property crime numbers. These differences were then divided by the total number of violent or property crimes in the first period of time. We divided by the total number of crimes in the previous period as opposed to the population in order to account for jurisdictions which began from already-high crime rates and the proportionately smaller increase in crime rate that the same absolute increase in crime would entail.

To calculate the synthetic control differences for comparison, we used the weights in the previous section and multiplied them by the proportional daily differences in crime between the two periods. We then summed up the the proportional daily differences and joined the two datasets together. We used bootstrapping to create a null distribution of 10000 differences in mean centered at 0 and determined if the probability of observing the difference between the mean proportional average daily increase in Denver or Colorado Springs with the mean proportional average daily increase in the synthetic control or greater was low enough to justify concluding that Denver or Colorado Springs' increase in violent crime was significantly greater than control jurisdictions.

#### Denver Violent Crime Tests

A table of the synthetic control jurisdictions for Denver violent crimes with weights is shown below:

```{r modify-weights}
weights_denver_violent <- synth_complete_test$solution.w
weights_denver_violent <- tibble(weight = weights_denver_violent, id = rownames(weights_denver_violent))

weights_denver_violent <- weights_denver_violent %>% 
  arrange(desc(weight)) %>% 
  mutate(id = as.numeric(id)) %>% 
  full_join(add_numbers_violent, by = "id") %>% 
  slice(1:4)

weights_denver_violent <- weights_denver_violent[, c(3, 1, 2)] %>% 
  select(NAME, weight) 
weights_denver_violent %>% 
  kable(digits = 3)
```

$H_0: \mu_{Denver} = \mu_{Synthetic}$. The true mean daily proportional difference in number of violent offenses between the June 2020 to May 2021 time period compared to the June 2019 to May 2020 time period in Denver, CO is equal to the true mean daily proportional difference in number of violent offenses between the two time periods in the synthetic control model.

$H_A: \mu_{Denver} > \mu_{Synthetic}$. The true mean daily proportional difference in number of violent offenses between the June 2020 to May 2021 time period compared to the June 2019 to May 2020 time period in Denver, CO is greater than the true mean daily proportional difference in number of violent offenses between the two time periods in the synthetic control model.

$\alpha$ = 0.01

Although we have population-level data, we utilized a bootstrapped simulation and hypothesis testing to determine if the difference between the Denver increases and the synthetic control increases could have resulted purely from chance.


```{r}
combined_synthetic_violent %>% 
  filter(date != as.Date("2021-06-02")) %>% 
  group_by(jurisdiction) %>% 
  summarise(mean = mean(diff))
```


```{r simulate-diff-synthetic}
null_dist <- combined_synthetic_violent %>% 
  filter(date != as.Date("2021-06-02")) %>% 
  specify(diff ~ jurisdiction) %>% 
  hypothesize(null = "independence") %>% 
  generate(reps = 10000, type = "permute") %>% 
  calculate(stat = "diff in means", 
            order = c("Denver", "Synthetic Control"))

obs_diff <- combined_synthetic_violent %>% 
  filter(date != as.Date("2021-06-02")) %>% 
  specify(diff ~ jurisdiction) %>% 
  calculate(stat = "diff in means", order = c("Denver", "Synthetic Control")) %>% 
  pull()

p <- null_dist %>% 
  filter(stat >= obs_diff) %>% 
  summarise(p_value = n()/nrow(null_dist)) %>% 
  pull()

p

```

The null distribution (with the red line displaying where the observed difference in mean between Denver and the synthetic control model lies) is graphically shown below:

```{r, fig.height = 4, fig.width = 5}
ggplot(null_dist, aes(x = stat)) + 
  geom_histogram() + 
  geom_vline(xintercept = obs_diff, lty = 2, color = "red") + 
  labs(title = "Null Distribution of Denver Violent Crime Differences in Mean", 
       x = "Differences in Mean", 
       y = "Count") + 
  theme_bw() + 
  theme(text = element_text(size = 9))
```

Because the p-value of `r p` is greater than a reasonable alpha level of 0.01, we fail to reject the null hypothesis. The data does not provide sufficient evidence at the 1% or 5% level that Denver's average daily increase in violent crimes from the 2019-20 time period to the 2020-21 time period is significantly greater than the synthetic control's average daily increase in violent crimes. However, the data does provide sufficient evidence at the 10% level that Denver's average daily increase in violent crime after the passage of the police accountability bill is significantly greater than the synthetic control's average daily increase in violent crime.

We also conducted a monthly difference in difference test using the synthetic control model as the "control" jurisdiction, since the graph modeling the trends of the synthetic control graph with true Denver trends indicated the possibility of parallel yearly violent crime trends between the synthetic control model and Denver, although the levels of the two models did not exactly match. By utilizing monthly data and linear modeling, we decreased the influence of daily crime fluctuations on the results while simultaneously retaining sufficient data points to draw some statistical conclusions.

```{r}
synthetic_control_graph <- synthetic_control_graph %>% 
  mutate(treated = as.factor(if_else(jurisdiction == "Denver", 1, 0))) %>% 
  mutate(time = as.factor(if_else(my >= as.Date("2020-07-01"), 1, 0))) %>% 
  mutate(did = treated * time)
did <- lm(n ~ time + treated + treated * time, data = synthetic_control_graph) 
tidy(did)
```

The interaction variable for time and treated reflects the difference in difference estimate. Because the p-value of 0.277 far exceeds a reasonable alpha level of 0.01, we fail to reject the hypothesis that the passage of qualified immunity in June 19, 2020 in Denver did not correspond to an increase in violent crime that outpaced other control jurisdictions. 

#### Denver Property Crime Tests

The following jurisdictions and weights were utilized to construct the synthetic control for Denver property crimes:

```{r modify-weights-denver-property}
weights_denver_prop_test <- synth_denver_property_test$solution.w
weights_denver_prop_test <- tibble(weight = weights_denver_prop_test, id = rownames(weights_denver_prop_test))
weights_denver_prop_test <- weights_denver_prop_test %>% 
  arrange(desc(weight)) %>% 
  mutate(id = as.numeric(id))
weights_denver_prop_test <- full_join(weights_denver_prop_test, add_numbers, by = "id")

weights_denver_prop_test <- weights_denver_prop_test[, c(3, 1, 2)] %>% 
  select(NAME, weight) %>% 
  slice(1:5)
weights_denver_prop_test %>% 
  kable(digits = 3)
```

Since Houston had such a low weight, I decided to exclude Houston from the analysis and run the bootstrapping with data from June 19, 2020 to June 19, 2021, accounting for a whole year of qualified immunity reform.

$H_0: \mu_{Denver} = \mu_{Synthetic}$. The true mean daily proportional difference in number of property offenses between the June 2020 to June 2021 time period compared to the June 2019 to June 2020 time period in Denver, CO is equal to the true mean daily proportional difference in number of violent offenses between the two time periods in the synthetic control model.

$H_A: \mu_{Denver} > \mu_{Synthetic}$. The true mean daily proportional difference in number of violent offenses between the June 2020 to June 2021 time period compared to the June 2019 to June 2020 time period in Denver, CO is greater than the true mean daily proportional difference in number of violent offenses between the two time periods in the synthetic control model.

$\alpha$ = 0.01


```{r simulate-diff-synthetic-property}
null_dist2 <- combined_synthetic_property %>% 
  specify(diff ~ jurisdiction) %>% 
  hypothesize(null = "independence") %>% 
  generate(reps = 10000, type = "permute") %>% 
  calculate(stat = "diff in means", 
            order = c("Denver", "Synthetic Control"))

obs_diff <- combined_synthetic_property %>% 
  specify(diff ~ jurisdiction) %>% 
  calculate(stat = "diff in means", order = c("Denver", "Synthetic Control")) %>% 
  pull()

p <- null_dist2 %>% 
  filter(stat >= obs_diff) %>% 
  summarise(p_value = n()/nrow(null_dist)) %>% 
  pull()

p

```

A histogram of the null distribution is shown below. The red line indicates that the true difference in mean between Denver and the synthetic control's increases in property crime is well above the hypothesized null distribution centered at 0.

```{r, fig.height = 4, fig.width = 5}
ggplot(null_dist2, aes(x = stat)) + 
  geom_histogram() + 
  geom_vline(xintercept = obs_diff, lty = 2, color = "red") + 
  labs(title = "Null Distribution of Denver Property Crime Differences in Mean", 
       x = "Differences in Mean", 
       y = "Count") + 
  theme(text = element_text(size = 9))
```

Because the p-value of `r p` is far less than a reasonable alpha level of 0.01, we reject the null hypothesis. The data provides sufficient evidence to indicate that Denver's average daily proportional increase in property crime after the passage of qualified immunity was significantly greater than control cities' increase in property crime over the same time period.

We did not employ a monthly difference in difference test because the parallel trends assumption is clearly violated, since the graph comparing the synthetic control trends with the true Denver trends is not parallel, especially from 2016-2017.

## Results and Discussion

The data does not provide evidence to indicate that Denver's increase in violent crime after qualified immunity significantly exceeded the violent crime increase in control cities. However, the data does suggest that Denver's increase in property crime did exceed the property crime increase in similar cities without qualified immunity reform. Unfortunately, because of the critical limitations in our data (see Methodology), we are unable to state that qualified immunity reform *caused* an increase in property crime in Denver. In addition, our exploratory data analysis may even provide evidence to the contrary; although Denver experienced a large rise in property crimes, Colorado Springs (the second largest jurisdiction in Colorado) did not experience much of a rise, making it possible that Denver-specific dynamics caused the increase in property crime. Once data from the census is released, we urge the conducting of more research to explore possible factors that may explain the rise in property crime in Denver that did not seem to be experienced at the same level elsewhere, even in the same state.

Our analysis is not over. In the future, we plan to take several steps to arrive at a stronger conclusion about whether qualified immunity reform had any clear effects on crime rates or police conduct. More immediately, we are creating a synthetic control for Colorado Springs to determine if Colorado Springs' increase in property crimes also exceeded control cities' increase. In addition, we also wish to eventually incorporate other large jurisdictions within Colorado, such as Boulder or Aurora, into the analysis to determine if Denver's crime trend or Colorado Springs' crime trend or a third crime trend entirely can best explain crimes within the rest of Colorado. For instance, it is fully possible that Colorado Springs' lack of a property crime increase could be the outlier, while the rest of Colorado experienced an increase in property crime. In that case, the data would provide more support for the conclusion that qualified immunity reform could cause increases in property crime. In the long-term, we also expect to incorporate 2020 census data (as well as data on the COVID recession, police trust, and police employment) into the analysis as predictor variables to help statistically control for alternative explanations. 


## References


## Appendix 1: Inflated Standard Deviations of Smaller Jurisdictions

The following graph is a density plot of the four jurisdictions that comprise the synthetic control for Denver's violent crimes and their daily standardized crime numbers.

```{r diagnostics-to-npap-graph}
wat1 <- wa_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- wa_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysiswa <- tibble(wat1, wat2) %>% 
  mutate(diff = (p2 - p1) / sum(p1)) %>% 
  mutate(pop_diff = (p2 - p1) / 753675 * 100000) %>% 
  mutate(jurisdiction = "Seattle") %>% 
  select(date, diff, pop_diff, jurisdiction)

wat1 <- tx_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- tx_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysistx <- tibble(wat1, wat2) %>% 
  mutate(diff = (p2 - p1) / sum(p1)) %>% 
  mutate(pop_diff = (p2 - p1) / 2320268 * 100000) %>% 
  mutate(jurisdiction = "Houston") %>% 
  select(date, diff, pop_diff, jurisdiction)

wat1 <- fspd_violent %>%
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n) 

wat2 <- fspd_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysisfspd <- tibble(wat1, wat2) %>% 
  mutate(diff = (p2 - p1) / sum(p1)) %>% 
  mutate(pop_diff = (p2 - p1) / 87891 * 100000) %>% 
  mutate(jurisdiction = "Fort Smith") %>% 
  select(date, diff, pop_diff, jurisdiction)

wat1 <- il_violent %>% 
  filter(time_period == "2019-20") %>% 
  select(n) %>% 
  rename("p1" = n)

wat2 <- il_violent %>% 
  filter(time_period == "2020-21") %>% 
  rename("p2" = n)

combined_analysisil <- tibble(wat1, wat2) %>% 
  mutate(diff = (p2 - p1) / sum(p1)) %>% 
  mutate(pop_diff = (p2 - p1) / 88909 * 100000) %>% 
  mutate(jurisdiction = "Champaign") %>% 
  select(date, diff, pop_diff, jurisdiction)

diagnostics <- full_join(combined_analysiswa, combined_analysisfspd) %>% 
  full_join(combined_analysistx) %>% 
  full_join(combined_analysisil) 

ggplot(diagnostics, aes(x = diff, fill = jurisdiction)) + 
  geom_density(alpha = 0.4) + 
  labs(title = "Diagnosic Plot of Synthetic Control Spreads", 
       x = "Daily Differences across Periods", 
       y = "Density", 
       fill = "Jurisdiction")
```

The density plot illustrates that jurisdictions with higher populations tend to have daily numbers that concentrate much more strongly at 0, while jurisdictions with lower populations tend to have daily proportionate numbers that fluctuate far more widely, thus significantly influencing the variation of the synthetic control. This effect is due to the significantly lower daily numbers of crimes that happen in smaller jurisdictions, causing the 1-2 crime number fluctuations that happen from day to day to comprise a larger proportion of the total number of violent crimes in the jurisdiction. The effect cannot be corrected by dividing by population instead.



